<?xml version="1.0"?>
<!DOCTYPE render SYSTEM "render.dtd">
<render>

	<targets>
		<texture name="depth" format="GL_DEPTH_COMPONENT32F" />
		<texture name="shadow_map" format="GL_DEPTH_COMPONENT32F" />
		<texture name="normals" format="GL_RGBA16F" />
		<texture name="lights_diffuse" format="GL_R11F_G11F_B10F" />
		<texture name="lights_specular" format="GL_R11F_G11F_B10F" />
		<texture name="HDR" format="GL_R11F_G11F_B10F" />
		<texture name="LDR" format="GL_RGBA8" />
		<texture name="bloom1" format="GL_R11F_G11F_B10F" size_divisor="4" />
		<texture name="bloom2" format="GL_R11F_G11F_B10F" size_divisor="4" />
		<texture name="luminance1" format="GL_RG16F" />
		<texture name="luminance2" format="GL_RG16F" />
		<texture name="edges" format="GL_R8" />
	</targets>

	<framebuffers>
		<framebuffer name="shadow-map">
			<output texture="shadow_map" />
		</framebuffer>
		<framebuffer name="normals-earlyZ">
			<output texture="depth" /> <!-- early z-cull -->
			<output texture="normals" />
		</framebuffer>
		<framebuffer name="lights">
			<output texture="lights_diffuse" />
			<output texture="lights_specular" />
		</framebuffer>
		<framebuffer name="bloom_br">
			<output texture="bloom1" />
		</framebuffer>
		<framebuffer name="bloom_bh">
			<output texture="bloom2" />
		</framebuffer>
		<framebuffer name="bloom_bv">
			<output texture="bloom1" />
		</framebuffer>
		<framebuffer name="HDR-earlyZ">
			<output texture="depth" /> <!-- early z-cull -->
			<output texture="HDR" />
		</framebuffer>
		<framebuffer name="HDR">
			<output texture="HDR" />
		</framebuffer>
		<framebuffer name="LDR">
			<output texture="LDR" />
		</framebuffer>
		<framebuffer name="luminance">
			<output texture="luminance1" />
		</framebuffer>
		<framebuffer name="edges">
			<output texture="edges" />
		</framebuffer>
	</framebuffers>

	<queue>
		<element type="geometry" framebuffer="normals-earlyZ" />
		<element type="shadowmap-directional" framebuffer="shadow-map" />
		<element type="lights" framebuffer="lights" >
			<param name="geometry_depth" value="depth" />
			<param name="geometry_normals" value="normals" />
		</element>
		<element type="lighting" framebuffer="HDR-earlyZ">
			<param name="diffuse_lights" value="lights_diffuse" />
			<param name="specular_lights" value="lights_specular" />
		</element>
<!--
		<element type="fog" framebuffer="HDR">
			<param name="geometry_depth" value="depth" />
		</element>
-->
		<element type="bright" framebuffer="bloom_br">
			<param name="texture" value="HDR" />
		</element>
		<element type="BlurH" framebuffer="bloom_bh">
			<param name="texture" value="bloom1" />
		</element>
		<element type="BlurV" framebuffer="bloom_bv">
			<param name="texture" value="bloom2" />
		</element>
		<element type="tone-mapping" framebuffer="LDR">
			<param name="texture" value="HDR" />
			<param name="avLum" value="0.5" />
			<param name="white2" value="0.5" />
		</element>
<!--
		<element type="sobel" framebuffer="edges">
			<param name="texture" value="depth" />
		</element>
		<element type="cel-shading" framebuffer="default">
			<param name="edges" value="edges" />
			<param name="color" value="LDR" />
		</element>
-->
		<element type="FXAA" framebuffer="default">
			<param name="texture" value="LDR" />
		</element>
		<element type="compose" framebuffer="default">
			<param name="texture" value="bloom1" />
		</element>
	</queue>

</render>
